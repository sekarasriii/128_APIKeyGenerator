<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>User Register - API Key Generator</title>
  <style>
    /* (pakai css yang sudah kamu punya; supaya ringkas saya hanya cantumkan struktur) */
    body { font-family: sans-serif; padding: 20px; background: #fafafa; }
    .container { max-width:700px; margin:0 auto; background:white;padding:24px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.08);}
    input, textarea, button { width:100%; padding:10px; margin-top:8px; border-radius:8px; border:1px solid #eee }
    .row { display:flex; gap:10px }
    .row input { flex:1 }
  </style>
</head>
<body>
  <div class="container">
    <h2>Daftar User & Generate API Key</h2>
    <div>
      <label>Nama Depan</label>
      <input id="firstName" />
      <label>Nama Belakang</label>
      <input id="lastName" />
      <label>Email</label>
      <input id="email" />
      <div class="row">
        <button id="generateBtn" onclick="generatePreview()">Generate Key</button>
        <button id="saveBtn" onclick="saveUserAndApiKey()">Simpan data user dan API key</button>
      </div>

      <label>Hasil API Key</label>
      <textarea id="apiKeyOutput" readonly placeholder="Klik Generate..."></textarea>
    </div>
  </div>

  <script>
    // hanya generate preview lokal dulu, actual key dibuat di server pada save (POST /create-user)
    function generatePreview() {
      // buat string sementara - tapi final key akan dibuat di server saat simpan
      const preview = 'preview-' + Date.now().toString(36) + '-' + Math.random().toString(36).slice(2,10)
      document.getElementById('apiKeyOutput').value = preview + '\n(Klik "Simpan data user dan API key" untuk menyimpan & membuat key yang valid di server.)'
    }

    async function saveUserAndApiKey() {
      const firstName = document.getElementById('firstName').value.trim()
      const lastName = document.getElementById('lastName').value.trim()
      const email = document.getElementById('email').value.trim()
      if (!firstName || !lastName || !email) return alert('Isi semua field')
      try {
        const res = await fetch('/create-user', {
          method:'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ firstName, lastName, email })
        })
        const data = await res.json()
        if (!res.ok) throw new Error(data.message || 'Gagal')
        document.getElementById('apiKeyOutput').value = data.data.apiKey
        alert('User & API key tersimpan')
      } catch (err) {
        console.error(err)
        alert('Error: '+err.message)
      }
    }
  </script>
</body>
</html>
